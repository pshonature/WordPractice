<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Word Practice, 2017</title>
    <link rel="stylesheet" href="w3.css">
    <style>
      @import url('https://fonts.googleapis.com/css?family=Fredericka+the+Great');
      @import url(http://fonts.googleapis.com/earlyaccess/nanumgothic.css);
      @import url(http://fonts.googleapis.com/earlyaccess/nanummyeongjo.css);
      @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);
      @import url('https://fonts.googleapis.com/css?family=Source+Code+Pro');
      .nanumGothic {
        font-family: 'Nanum Gothic', sans-serif;
      }
      .nanumMyeongjo {
        font-family: 'Nanum Myeongjo', serif;
      }
      .nanumGothicCoding {
        font-family: 'Nanum Gothic Coding', monospace;
      }
      .frederikaTheGreat {
        font-family: 'Fredericka the Great', cursive;
      }
      .scpro {
        font-family: 'Source Code Pro', monospace;
      }
      body {
        /*background-color: #E7F7D4;*/
        background-color: black;
        font-family: 'Nanum Gothic', sans-serif;
      }
      /* =========================================== */

      .bander-default, .bander-navy {
        border: 5px solid #ddd;
        border-radius: 5px;
        background-color: #eee;
        padding: 5px;
        /*float: right;*/
        margin-left: 1px;
        margin-right: 1px;
        color: black;
      }
      .bander-navy {
        background-color: navy;
        color: white;
        border-color: #33f;
      }
      .label-head {
        font-weight: bold;
      }
      .label-head-orange {
        font-weight: bold;
        color: #f90;
      }
      .label-value {
        border: 1px solid #99ceff;
        border-radius: 5px;
        background-color: #0069cc;
        padding: 3px;
        padding-left: 7px;
        padding-right: 7px;
        margin-left: 5px;
        font-weight: bold;
        color: #fc0;
      }
      .label-mini-value {
        border: 1px solid #99ceff;
        border-radius: 3px;
        background-color: #0069cc;
        width: 20px;
        padding-left: 3px;
        padding-right: 3px;
        color: #fc0;
        display: inline-block;
        text-align: right;
      }
      .label-value-off {
        border: 1px solid #6387a8;
        border-radius: 5px;
        background-color: #7da7cf;
        padding: 3px;
        padding-left: 7px;
        padding-right: 7px;
        margin-left: 5px;
        font-weight: bold;
        color: #fff4c6;
      }
      .label-value-skey {
        border: 1px solid #00d9ff;
        border-radius: 5px;
        background-color: #6facf2;
        padding: 2px;
        padding-left: 7px;
        padding-right: 7px;
        margin-left: 5px;
        font-weight: bold;
        color: #000000;
      }
      /* =========================================== */
      table.tableWordList {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid gray;
      }
      td.tableWord, th.tableWord {
        width: 180px;
        font-size: 13pt;
        font-weight: bold;
        text-align: center;
      }
      td.tablePronunciation, th.tablePronunciation {
        width: 200px;
      }
      td.tablePronunciation {
        font-weight: normal;
        font-size: 11pt;
        color: #666;
      }
      td.tableMemo, th.tableMemo {
        font-size: 11pt;
      }
      td.tableReserved, th.tableReserved {
        width: 250px;
        display: none;
      }
      tr.tableWordRow:hover {
        border: 1px solid blue;
      }
      th {
        background-color: darkgray;
      }
      div.defenceBase {
        left: 8px;
        bottom: 5px;
        right: 8px;
        border: 1px solid darkgray;
        position: absolute;
        background-color: #66b48e;
        font-size: 15pt;
        margin: 0px;
        border-radius: 3px;
        box-shadow: 3px 3px 3px gray;
        padding: 5px;
      }
      input {
        background-color: #c5f0db;
        font-size: 14pt;
        padding: 3px;
        color: #2c1da8;
      }
      .memo {
        /*width: 250px;*/
        padding: 3px;
        border-radius: 3px;
        border: 1px solid darkgray;
        background-color: lightyellow;
        font-size: 10pt;
        color: black;
        position: absolute;
        z-index: 1;
        display: none;
      }
      .memoTitle {
        border-bottom: 1px dotted gray;
        font-weight: bold;
        color: #0066ff;
        font-size: 14pt;
        margin-bottom: 3px;
        background-color: #cf6;
        padding: 3px;
      }
      .memoBody {
        font-size: 12pt;
        line-height: 20px;
        padding: 3px;
      }
      #currentEditWord {
        width: 98%;
        font-size: 10pt;
      }
      /*#################### psho-css ###################*/
      button.btnWP {
        border-radius: 5px;
        background-color: #010ca4;
        color: #ffed00;
        padding: 5px;
      }
      button.btnWP:hover {
        background-color: #055bdb;
        color: #ffed00;
      }
      div.psho-container {
        border: 1px solid darkgray;
        padding: 10px;
        border-radius: 3px;
        background-color: #66b48e;
      }
      .psho-shadow-default {
        box-shadow: 3px 3px 2px darkgray;
      }
      div.psho-label-title{
        padding: 0px;
        font-size: 20pt;
        color: black;
        float: left;
        margin-right: 20px;
      }
      td.numberTitle {
        font-size: 14pt;
        width: 120px;
      }
      span.numberDisplay {
        font-size: 16pt;
        color: blue;
      }
      #collection {
        position: realtive;
        margin-top: 10px;
        border: 1px solid gray;
        background-color: #eeffaa;
        padding: 10px;
        overflow: scroll;
        border-radius: 5px;
        box-shadow: 3px 3px 2px #999;
        padding-top: 0px;
        display: none;
        margin-left: auto;
        margin-right: auto;
      }
      #collectionTitleArea {
        margin-top: 5px;
        background-color: #d3f965;
        position: -webkit-sticky;
        position: sticky;
        border: 1px solid gray;
        border-radius: 5px;
        top: 0;
        box-shadow: 3px 3px 2px darkgray;
      }
      #collectionTitle {
        position: relative;
        /*float: left;*/
        padding-bottom: 5px;
        padding-left: 10px;
      }
      #collectionWords {
        margin-top: 5px;
      }
      div.wordList {
        width: 120px;
        padding: 3px;
        /*position: absolute;*/
        float: left;
        border: 1px dotted gray;
        border-radius: 5px;
        background-color: #cef;
      }
      div.wordList:hover {
        background-color: #ff9;
        box-shadow: 3px 3px 3px #0cf;
        cursor: e-resize;
      }
      .wordListSplit {
        border-color: gray;
        margin-top: 5px;
        margin-bottom: 5px;
      }
      .wordExposed {
        color: #093;
      }
      .wordMissed {
        color: #f00;
      }
      .wordPaired {
        color: #00f;
      }
      span.pronunciation {
        font-size: 11pt;
        color: #222;
        margin-left: 5px;
        font-weight: normal;
      }
      div.bubbleTip  {
        border: 1px solid gray;
        background-color: lightyellow;
        position: absolute;
        border-radius: 3px;
        font-size: 11pt;
        color: black;
        padding: 5px;
        box-shadow: 3px 3px 2px #999;
      }
      /* ================ Style for Test =======================*/
      div.testArea {
        width: 70%;
        margin-left: auto;
        margin-right: auto;
        margin-top: 10px;
        display: none;
      }
      div.testHead {
        border: 1px solid gray;
        border-radius: 10px;
        padding: 10px;
        font-size: 20pt;
        font-family: Arial, Helvetica, sans-serif;
        background-color: darkgray;
      }
      div.testBody {
        padding-top: 5px;
      }
      #testQuestion {
        border: 1px solid gray;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
        padding: 10px;
        padding-left: 40px;
        font-size: 30pt;
        font-family: Arial, Helvetica, sans-serif;
        color: white;
        background-color: #333;
      }
      #testExampleArea {
        border: 1px solid gray;
        border-bottom-right-radius: 15px;
        border-bottom-left-radius: 15px;
        padding: 10px;
        background-color: lightgray;
      }
      div.testExample {
        padding: 10px;
        font-size: 17pt;
        margin-top: 15px;
        margin-bottom: 15px;
        padding-left: 30px;
        border-bottom: 1px dotted gray;
      }
      div.testExample:hover {
        background-color: #eee;
      }
      #testTitle {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20pt;

      }
      .movingWord {
        text-align: center;
        padding: 5px;
        padding-top: 7px;
        font-size: 14pt;
        border: 1px dotted blue;
        background-color: lightblue;
        position: absolute;
        border-radius: 3px;
        box-shadow: 3px 3px 2px #999;
        font-weight: bold;
      }
      button {
        font-size: 12pt;
      }
      .miniLabel {
        border: 1px solid red;
        width: 45px;
        height: 19px;
        position: absolute;;
        background-color: #f2522f;
        color:white;
        border-radius: 5px;
        text-align: center;
        font-size: 10pt;
        top: 0;
        left: 0;
        margin-top: 4px;
        margin-left: 200px;
        padding-bottom: 3px;
        display: none;
      }
      /* ------------------starting Logo----------------------- */
      .logoContainer {
         background-color: #3c7d4a;
         position: relative;
         width: 50%;
         padding-top: 20%; /* 16:9 Aspect Ratio */
         margin: auto;
         border-radius: 30px;
         top: 100px;
         box-shadow: 10px 10px 35px #538b7a;
         border: 1px solid white;
      }

      .logoText {
         position:  absolute;
         top: 0;
         left: 0;
         bottom: 0;
         right: 0;
         text-align: center;
         font-size: 20px;
         color: white;
         padding: 30px;
      }
      #trashCan {
        width: 150px;
        height: 150px;
        position: absolute;
        bottom: 70px;
      }
      #wordNote {
        position: absolute;;
        bottom: 70px;
        height: 150px;
      }
      /* --------------------------------------------------- */
      /* ================ Style for Test =======================*/
      .show {
        display: block
      }
      .litem {
        border: 1px solid gray;
        padding: 3px;
        border-top-left-radius: 6px;
        border-bottom-right-radius: 6px;
        background-color: #f9cb9c;
      }
      li {margin-bottom: 7px;}
      .codeKey {
        border: 1px solid gray;
        background-color: #e9e9e9;
        border-radius: 3px;
        padding-left: 3px;
        padding-right: 3px;
        font-family: 'Source Code Pro', monospace;
      }
    </style>

    <script src="jquery-3.2.1.min.js"></script>
    <script src="underscore-min.js"></script>
    <script src="wordBook4.js"></script>
    <script>
      function WPUser(username, masterCollection) {
        this.userName = username;
      }
      let wpUser = {
        userName: "Word Practice User",
        masterCollection: null,
        finishedCollection: null,
        dateStarted: null,
        countStudy: 0,
        dateLastStudy: null,
      }
      //##########################################################################
      //Add "toNumber" method to String,   for "345px" => 345
      String.prototype.toNumber = function() {return parseInt(this);};
      //##########################################################################
      // Style Object
      //--------------------------------------------------------------------------
      //##########################################################################
      //---------------------------------------------------------------
      let wordBOOK              = new Collection();  //Master Word Book
      //~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!!~!~!~
      let wordFinished          = new Collection("단어 휴지통", "trash"); // Words need not to study
      //~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!~!!~!~!~
      let wordKilled            = new Collection("Words Catched");
      let wordPicked            = new Collection("Words Picked from wordBOOK");
      let wordSource            = new Collection("Words Waiting");
      let wordBase              = new Collection("Moving Words", "move", wordSource);
      let wordMissed            = new Collection("Words Missed");
      let myWordBook            = new Collection("My Word Book");

      let gameConfig = {
        "boxWidth":               150,
        "clockSpeed":             1000,
        "clockSpeedMinimum":      300,
        "fetchSpeed":             5000,
        "handleWordMoving":       null,
        "handleFetching":         null,
        "hitColor":               "#ffdddd",
        "notHitColor":            "lightblue",
        "defenceBaseTop":         0,
        "downSpeed":              {min: 15, max: 30},
        "startTop":               50,
        "warnningDistance":       255,
        "showCollectionBody":     null,
        "showCollectionTitle":    null,
        "showCollectionList":     null,
        "collectionViewStyle":    "WordList",  // "WordList", "WordBook,
        "previousViewCollection": null,
        "currentViewCollection":  null,
        "currentTest":            null,
        "currentProblem":         null,
        "testInterval":           4000,  // in case of wrong selectio,
        "correctInterval":        4000,  // in case of right selectio,
        "numberOfWrongExamples":  3,
        "status":                 "wait", //one of wait|test|game|vie,
        "colorExposed":           "#093",
        "handleMemoShow":         null,
        "showMemo":               true,
        "countZoneStaus":         "hide",
        "heightOfInfoDiv":        0,
        "heightOfDefenceBase":    0,
        "spaceControl":           true,
        "masterCollection":       null,
        "referenceWidth":         1900,
        "referencePoint":         60,
        "referenceTextPoint":     15,
        "draggedElement":         null,
        "draggedWord":            null,
        "currentEditTR":          null,
        "curentEditWord":         null,
        "helpInfoStatus":         null
      };

      //===============================================================
      // Word Object(div element) 생성자
      //---------------------------------------------------------------
      function Word(titleWord, memo='', pronunciation='') {
        this.word          = titleWord;
        this.pronunciation = pronunciation;
        this.memo          = memo;
        this.countExposed  = 0;
        this.countMissed   = 0;   // scoreValue로 통합됨 (사용하지 않음)
        this.countPaired   = 0;   // scoreValue로 통합됨 (사용하지 않음)
        this.scoreValue    = 0;
        this.downSpeed     = Math.floor(Math.random()*(gameConfig.downSpeed.max-gameConfig.downSpeed.min) + gameConfig.downSpeed.min);
        // this.div = document.createElement('div');
        // this.div.appendChild(document.createTextNode(`<b>${this.word}</b>`));
        // this.div.innerHTML = this.word;
        // document.body.appendChild(this.div);
        this.div           = $(`<div>${this.word}</div>`).addClass("movingWord");
        $(this.div).appendTo("body");
        // $(this.div).addClass("movingWord");
        this.moveToStart();
        this.hide();
      }
      Word.prototype.distanceToBottom = function(targetValue = gameConfig.defenceBaseTop) {
        return targetValue - ($(this.div).css("top").toNumber() + $(this.div)[0].offsetHeight);
      }
      Word.prototype.exposed = function(c) { //현재 값이 필요하면 c에 true 입력
        return (c)? this.countExposed : ++this.countExposed;
      }
      Word.prototype.get = function(propertyName) {
        return this[propertyName];
      }
      Word.prototype.getESMP = function() {
        return `e:<div class="label-mini-value">${this.countExposed}</div>, s:<div class="label-mini-value">${this.scoreValue}</div>, m:<div class="label-mini-value">${this.countMissed}</div>, p:<div class="label-mini-value">${this.countPaired}</div>`;
      }
      Word.prototype.getPropertyFromSavedWord = function(savedWord) {
        this.countExposed = savedWord.countExposed;
        this.countMissed  = savedWord.countMissed;
        this.countPaired  = savedWord.countPaired;
        this.scoreValue   = savedWord.scoreValue;
      }
      Word.prototype.hide = function() {
        $(this.div).hide();
      }
      Word.prototype.hit = function() {
        $(this.div).css('backgroundColor', gameConfig.hitColor);
        $(this.div).fadeOut("fast");
      }
      Word.prototype.isCritical = function() {
        let distance = this.distanceToBottom();
        if(distance < gameConfig.warnningDistance) {
          $(this.div).css("backgroundColor", `rgb(255, ${distance}, 255)`);
          // $(this.div).css("color", `rgb(${255-distance}, ${255-distance}, ${255-distance})`);
          if(distance < 127)
            $(this.div).css("color", "white");
        }
        return distance;
      }
      Word.prototype.mark = function(substr, color) {
        if(substr.trim().length > 0) {
          if(this.distanceToBottom() < 127)
            color = "#1cff00";
          $(this.div).html(this.word.replace(substr,`<span style="color:${color};">${substr}</span>`));
        } else {
          $(this.div).html(this.word);
        }
      }
      Word.prototype.missed = function(c) { //현재 값이 필요하면 c에 true 입력
        if(c == undefined)
          this.scoreValue--;
        return (c)? this.countMissed : ++this.countMissed;
      }
      Word.prototype.moveDown = function(targetValue = gameConfig.defenceBaseTop) {  // return targetValue - new top value
        let newTop = $(this.div).css("top").toNumber() + this.downSpeed;
        $(this.div).css("top", `${newTop}px`);
      }
      Word.prototype.moveTo = function(x, y) {
        x = (String(x).search("px") < 0) ? x + "px" : x;
        y = (String(y).search("px") < 0) ? y + "px" : y;
        $(this.div).css({"left": x, "top": y});
      }
      Word.prototype.moveToStart = function(defaultTop=gameConfig.startTop) {
        let x = Math.floor(Math.random()*(window.innerWidth-gameConfig.boxWidth));
        this.moveTo(x, defaultTop);
      }
      Word.prototype.paired = function(c) {  //현재 값이 필요하면 c에 true 입력
        if(c == undefined)
          this.scoreValue++;
        return (c)? this.countPaired : ++this.countPaired;
      }
      Word.prototype.score = function() {
        return this.scoreValue;
      }
      Word.prototype.show = function() {
        // $(this.div).css("backgroundColor", "lightblue");
        $(this.div).slideDown('fast');
      }
      Word.prototype.showMemo = function(shower=memoShow, hider=memoHide, duration=2500) {
        clearTimeout(gameConfig.handleMemoShow);
        shower(this);
        gameConfig.handleMemoShow = setTimeout(function(){hider(this)}, duration);
      }
      Word.prototype.toString = function() {
        let str  = `{"word":"${this.word}",`;
        str     += `"pronunciation":"${this.pronunciation}",`;
        str     += `"memo":"${this.memo}",`;
        str     += `"countExposed":${this.countExposed},`;
        str     += `"countMissed":${this.countMissed},`;
        str     += `"countPaired":${this.countPaired},`;
        str     += `"scoreValue":${this.scoreValue}}`;
        return str;
      }
      //===============================================================
      function Collection(title = "Word Collection", style = "store", sourceCollection) {
        this.title             = title;
        this.words             = [];
        this.wordCountShowList = [];
        this.currentMark       = "";
        this.currentMarkColor  = null;
        this.handleMoving      = null;
        this.handleFetching    = null;
        this.style             = style;  // one of "move", "store", "trash"
        this.targetToFetchOut  = null;
        this.targetForMissed   = null;  //Word.isCritical() < 0인 경우 보낼 colleciton
        this.sourceCollection  = sourceCollection;
        this.onEmptyToFetch    = null;
      }
      Collection.prototype.onEmptyToFetchOut = function(callback) {
        this.onEmptyToFetch = callback;
      }
      Collection.prototype.attachWords = function(targetElement) {
        let wordList = "";
        targetElement.innerHTML = "";
        for(let word of this.words) {
          if(word.score()>0) {
            let k = $(`<div id='WL_${word.word}' draggable="true" ondragstart='dragStart(event);' ondragend="dragEnd(event);">${word.word}</div>`);
            k.addClass("wordList wordPaired").appendTo(targetElement);
          } else if (word.score()<0) {
            let k = $(`<div id='WL_${word.word}' draggable="true" ondragstart='dragStart(event);' ondragend="dragEnd(event);">${word.word}</div>`);
            k.addClass("wordList wordMissed nanumGothic").appendTo(targetElement);
          } else if(word.exposed(true)){
            let k = $(`<div id='WL_${word.word}' draggable="true" ondragstart='dragStart(event);' ondragend="dragEnd(event);">${word.word}</div>`);
            k.addClass("wordList wordExposed nanumGothic").appendTo(targetElement);
          } else {
            let k = $(`<div id='WL_${word.word}' draggable="true" ondragstart='dragStart(event);' ondragend="dragEnd(event);">${word.word}</div>`);
            k.addClass("wordList nanumGothic").appendTo(targetElement);
          }
        }
        // targetElement.innerHTML = wordList;
        $("div.wordList").mouseenter(function() {wordListTipShowHover(this);});
        $("div.wordList").click(function() {wordListTipShow(this);});
        $("div.wordList").mouseout(function() {wordListTipHide(this);});
        // $("div.wordList").dblclick(function(){$(this).remove();});

      }
      Collection.prototype.attachWordsTable = function(targetElement) {
        let wordTable = "<table class='tableWordList'><thead><th class='tableWord'>Word</th><th class='tablePronunciation'>Pronunciation</th><th class='tableMemo'>Memo</th><th class='tableReserved'>Reserved</th></thead><tbody>";
        for(let  word of this.words) {
          let info =word.getESMP();
          if (word.score()<0) {
            wordTable += `<tr id='WT_${word.word}' ondblclick='editThisRow(this);' draggable='true' ondragend="dragEnd(event);" ondragstart='dragStart(event);' class='tableWordRow'><td class='tableWord wordMissed nanumGothic';">${word.word}</td><td class='tablePronunciation'>[${word.pronunciation}]</td><td class='tableMemo nanumMyeongjo'>${word.memo}</td><td class="tableReserved">${info}</td></tr>`;
          } else if (word.score()>0) {
            wordTable += `<tr id='WT_${word.word}' ondblclick='editThisRow(this);' draggable='true' ondragend="dragEnd(event);" ondragstart='dragStart(event);' class='tableWordRow'><td class='tableWord wordPaired nanumGothic';">${word.word}</td><td class='tablePronunciation'>[${word.pronunciation}]</td><td class='tableMemo nanumMyeongjo'>${word.memo}</td><td class="tableReserved">${info}</td></tr>`;
          } else if(word.exposed(true)) {
            wordTable += `<tr id='WT_${word.word}' ondblclick='editThisRow(this);' draggable='true' ondragend="dragEnd(event);" ondragstart='dragStart(event);' class='tableWordRow'><td class='tableWord wordExposed nanumGothic';">${word.word}</td><td class='tablePronunciation'>[${word.pronunciation}]</td><td class='tableMemo nanumMyeongjo'>${word.memo}</td><td class="tableReserved">${info}</td></tr>`;
          } else {
            wordTable += `<tr id='WT_${word.word}' draggable='true' ondragend="dragEnd(event);" ondragstart='dragStart(event);' word='${word.word}' onclick='exposeThisRow(this);' class='tableWordRow'><td class='tableWord nanumGothic'>${word.word}</td><td class='tablePronunciation'>[${word.pronunciation}]</td><td class='tableMemo nanumMyeongjo'>?</td><td class="tableReserved">${info}</td></tr>`;
          }
        }
        wordTable += "</tbody> </table>";
        targetElement.innerHTML = wordTable;
        $("tr.tableWordRow:odd").css("backgroundColor", "#c4fccd");
        $("tr.tableWordRow:even").css("backgroundColor", "#dfffdf");
      }
      Collection.prototype.clearWords = function() {
        this.hideAll();
        this.words = [];
        this.showLength();
      }
      Collection.prototype.copyWordsTo = function(targetCollection, mode="clear") {
        if(mode !== "append")
          targetCollection.clearWords();
        for(let aWord of this.words)
          targetCollection.push(aWord);
      }
      Collection.prototype.fetchOutToDefault = function() {
        if(this.targetToFetchOut) {
          let word = this.popRandom();
          if(word)
            this.targetToFetchOut.push(word);
        }
      }
      Collection.prototype.fetchOutToMissed = function(aWord) {
        let index = -1;
        if(this.words.length) {
          for(index = 0; index < this.words.length; index++) {
            if(this.words[index].word == aWord.word) {
              aWard = this.words.splice(index,1)[0];
              this.showLength();
              this.targetForMissed.push(aWord);
              return;
            }
          }
        }
      }
      Collection.prototype.findAndFetchToDefault = function(str) {
        if(this.targetToFetchOut) {
          for(let i in this.words) {
            if(this.words[i].word == str) {
              let word = this.words.splice(i,1)[0];
              this.showLength();
              this.targetToFetchOut.pickUp(word);
              if(gameConfig.showMemo)
                word.showMemo();
              // setTimeout(this.startMoving.bind(this), 2000);
              // setTimeout(this.showAll.bind(this), 2000);
              return;
            }
          }
        }
      }
      Collection.prototype.findAndPick = function(strWord) {
        for(let i in this.words) {
          if(this.words[i].word == strWord) {
            let word = this.words.splice(i, 1)[0];
            this.showLength();
            return word;
          }
        }
        return null;
      }
      Collection.prototype.findWord = function(str) {
        for(let i in this.words) {
          if(this.words[i].word == str)
            return this.words[i];
        }
        return null;
      }
      Collection.prototype.findWordAndGetMemo = function(str) {
        let word = this.findWord(str);
        return (word)? word.memo : '';
      }
      Collection.prototype.getTitle = function() {
        return this.title;
      }
      Collection.prototype.hideAll = function() {
        for(let word of this.words)
          word.hide();
      }
      Collection.prototype.isCurrentViewCollection = function() {
        gameConfig.currentViewCollection = this;
        themeTitleFrom(this);
        if(gameConfig.masterCollection == this) {
          $("#wordsTotal").html(gameConfig.masterCollection.length());
        } else {
          $("#wordsTotal").html(this.length());
          // $("#wordsTotal").html(this.length() + '<span style="color:white;"> / </span>' + gameConfig.masterCollection.length());
        }
      }
      Collection.prototype.length = function() {
        return (this.words == null)? 0 : this.words.length;
      }
      Collection.prototype.makeWordsFromString = function(str) {
        let words = str.split(",");
        for(let word of words) {
          if(word.trim().length > 0) {
            this.push(new Word(word));
            this.showLength();
          }
        }
      }
      Collection.prototype.makeWordsFromWordBook = function(wb) {
        let wordArray = wb.words;
        this.title = wb.title;
        for(let word of wordArray) {
          if(word.hasOwnProperty("pronunciation"))
            this.push(new Word(word.word, word.memo, word.pronunciation.trim()));
          else
            this.push(new Word(word.word, word.memo));
          this.showLength();
        }
      }
      Collection.prototype.markMovingWords = function(substr, color="red") {
        this.currentMark = substr;
        this.currentMarkColor = color;
        for(let word of this.words)
          word.mark(this.currentMark, this.currentMarkColor);
      }
      Collection.prototype.moveWords = function() {
        if(this.length() <= 0 && this.sourceCollection.length() <= 0) {
          gameControl("finished");
          gameReset();
          _id("btnGameControl").innerHTML = "Start Game";
          _id("btnGameControl").onclick = function(){gameStart()};
          $("#btnTestControl").show();
          $("#keyInput").focus();
          return;
        }
        let missed = [];
        if(this.style == "move") {
          for(let word of this.words) {
            word.moveDown();
            if(word.isCritical() < 0) {
              missed.push(word);
            }
          } // end of for
          // missed word가 발생했다면
          if(missed.length > 0) {
            for(let aWord of missed) {
              this.fetchOutToMissed(aWord);
            }
          }
        }// end of outer if
      }// end of function
      Collection.prototype.pickUp = function(aWord) {
        if(aWord) { //aWord가 null이 아닌 경우에만 처리
          this.words.push(aWord);
          this.showLength();
          aWord.hit();
          //Memo 기능 처리 코드
          // memoShow(aWord);
          // setTimeout(function(){memoHide(aWord)}, 1500);
        }
      }
      Collection.prototype.popRandom = function() {
        if(this.words.length) {
          let picker = Math.floor(this.words.length * Math.random());
          let word = this.words.splice(picker, 1)[0];
          this.showLength();
          return word;
        } else {
          return null;
        }
      }
      Collection.prototype.push = function(aWord) {
        if(aWord) { //aWord가 null이 아닌 경우에만 처리
          //새 단어가 기존 단어들과 중복되는지 체크한다. 중복되면 return false
          if(_.find(this.words, function(a) { return a.word === aWord.word; })){
            console.log(`Collection:[${this.title}]: pushing a new word[${aWord.word}] is rejected on duplication.`);
            return false; //새 단어 등록 거절.
          }
          this.words.push(aWord);
          this.showLength();
          if(this.style == "move") {
            $(aWord.div).css("backgroundColor", gameConfig.notHitColor);
            aWord.moveToStart();
            aWord.show();
            aWord.mark(this.currentMark, this.currentMarkColor);
          }
          else
            aWord.hide();
          return true;
        }
        return false;
      }
      Collection.prototype.randomSelectAndCopyTo = function(count, targetCollection) {
        if(count > this.words.length)
          count = this.words.length;
        let randomIndexToPick = randomSequence(this.words.length, count);
        for(let i in randomIndexToPick)
          targetCollection.push(this.words[randomIndexToPick[i]]);
      }
      Collection.prototype.searchAndCopyTo = function(selector, targetCollection) {
        let selectedWords = _.filter(this.words, (word)=>{return word.word.startsWith(selector);})
        for(let aWord of selectedWords)
          targetCollection.push(aWord);
      }
      Collection.prototype.selectedLength = function(selector) {
        return _.filter(this.words, (word)=>{return word.word.startsWith(selector)}).length;
      }
      Collection.prototype.setTitle = function(newTitle) {
        this.title = newTitle;
      }
      Collection.prototype.shift = function() {
        let word = this.words.shift();
        this.showLength();
        return word;
      }
      Collection.prototype.showAll = function() {
        for(let word of this.words)
          word.show();
      }
      Collection.prototype.showLength = function(element) {
        if(element) {
          this.wordCountShowList.push(element);
        } else {
          if(this.wordCountShowList.length > 0)
            for(let e of this.wordCountShowList)
              e.innerHTML = this.words.length;
        }
        if(this.style==="trash")
          $("#trashCount").text(this.words.length);

        if(gameConfig.currentViewCollection)
          gameConfig.currentViewCollection.isCurrentViewCollection();
      }
      Collection.prototype.showListOfWords = function(showType = gameConfig.collectionViewStyle) {
        if(this.words.length) {
          if(this.style === "trash")
            $("#collection").css("backgroundColor","#ff9c71");
          else {
            $("#collection").css("backgroundColor","#eeffaa");
          }
          this.sortByWords();
          if(showType == "WordList") {
            gameConfig.collectionViewStyle = showType;
            this.attachWords(gameConfig.showCollectionList);
            $("#btnWordList").hide();
            $("#btnWordBook").show();
          }
          else {
            gameConfig.collectionViewStyle = showType;
            this.attachWordsTable(gameConfig.showCollectionList);
            $("#btnWordList").show();
            $("#btnWordBook").hide();
          }
          if(wordFinished.length()){
            if(gameConfig.previousViewCollection)
              $("#trashCanControl").html(`Close Trash Can <span id="trashCount" class="label-mini-value">${wordFinished.length()}</span>`);
            else
              $("#trashCanControl").html(`View Trash Can <span id="trashCount" class="label-mini-value">${wordFinished.length()}</span>`);
            $("#trashCanControl").show();
          }
          else
            $("#trashCanControl").hide();
          $(gameConfig.showCollectionBody).show();
        } else {
          $(gameConfig.showCollectionBody).hide();
        }
      }
      Collection.prototype.sortByWords = function() {
        this.words.sort(function(a, b) { if(a.word > b.word) return 1; else if(a.word === b.word) return 0; else return -1;});
      }
      Collection.prototype.startFetching = function() {
        this.fetchOutToDefault();
        this.handleFetching = setInterval(this.fetchOutToDefault.bind(this), gameConfig.fetchSpeed);
      }
      Collection.prototype.startMoving = function() {
        this.moveWords();
        if(this.style == "move")
          this.handleMoving = setInterval(this.moveWords.bind(this), gameConfig.clockSpeed);
      }
      Collection.prototype.stopFetching = function() {
        clearInterval(this.handleFetching);
        this.handleFetching = null;
      }
      Collection.prototype.stopMoving = function() {
        if(this.style == "move") {
          clearInterval(this.handleMoving);
          this.handleMoving = null;
        }
      }
      Collection.prototype.stringHeader = function(targetElement) {
        let header =  `<span>Title: [<b>${this.title}</b>] &nbsp;&nbsp;<span style="font-size:12pt">(<span class="numberDisplay">${this.words.length}</span>) words.</span></span>`;
        targetElement.innerHTML = header;
      }
      Collection.prototype.styleIs = function(style) {
        if(style == "move") {
          this.style = style;
          this.showAll();
        } else {
          this.style = "store";
          this.hideAll();
        }
      }
      Collection.prototype.targetForMissedIs = function(collection) {
        this.targetForMissed = collection;
      }
      Collection.prototype.targetToFetchOutIs = function(collection) {
        this.targetToFetchOut = collection;
      }
      Collection.prototype.toString = function() {
        let dateSaved  = new Date().toString();
        let str        = `{ "title": "${this.title}",`;
        str           += `"userName": "wordPracticeUser",`;
        str           += `"dateSaved": "${dateSaved}",`;
        str           += `"words": [`;
        if(this.words.length) {
          for(let i = 0; i<this.words.length-1; i++)
              str += this.words[i].toString() + ","
          str += this.words[this.words.length-1].toString() + "]}";
        } else {
          str += "]}";
        }
        return str;
      }
      Collection.prototype.toNewWindowInJSON = function() {
        let newWin      = window.open("", "_blank");
        let body        = newWin.document.body;
        body.innerHTML  = `<h1>${this.title}</h1><hr />`;
        body.innerHTML += `Number of Words: <b>${this.length()}</b> words.<hr />`;
        body.innerHTML += `<code>${this.toString()}</code><hr />`;

      }
      //===============================================================
      function Problem(index, collection) {
        // check initial condition
        if(collection == null || collection.length() <= 0 || index >= collection.length()) {
          console.log(`Error: Problem(): Not valid condition to make a problem.`);
          alert(`Error: Problem(): Not valid condition to make a problem.`);
          return;
        }
        //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        let wrongExamples = (collection.length() < (gameConfig.numberOfWrongExamples+1))? collection.length() - 1: gameConfig.numberOfWrongExamples;
        this.key          = collection.words[index];
        this.words        = [];
        this.words.push(this.key);
        this.index = [];
        this.index.push(index);
        this.timeStarted    = null;
        this.timeInterval   = null;
        this.wasHit         = false;      //will be changed to 'true' on choosing correct answer
        this.wrongAnswer    = null;
        let randomWordIndex = randomSequence(collection.length(), wrongExamples, index);
        for(let i           = 0; i<randomWordIndex.length; i++) {
          this.words.push(collection.words[randomWordIndex[i]]);
          this.index.push(randomWordIndex[i]);
        }
        this.collection = collection;
        this.test = null;
      }
      //===============================================================
      function Test(collection, count=collection.length(), type="word") {
        this.type       = type;
        this.timeLimit  = 0;  // 0: no time limit.  (unit: seconds)
        this.collection = collection;
        if(count > collection.length())
          count = collection.length();
        this.problemIndexArray = randomSequence(collection.length(), count);
        this.problems          = [];
        this.currentProblem    = null;
        this.currentIndex      = -1;
        for(let i              = 0; i<count; i++) {
          let newProblem = new Problem(this.problemIndexArray[i], collection);
          this.problems.push(newProblem);
          newProblem.test = this;
        }
        this.dateCreated = (new Date()).toString();
      }
      Test.prototype.current = function(type="index") {  //or "problem" for object
        return (type === "index")? this.currentIndex : this.currentProblem;
      }
      Test.prototype.finishTest = function() {
        $("div.testArea").fadeOut(1000);
        $("#keyInput").focus();
        gameConfig.currentTest = null;
        gameConfig.status = "wait";
        _id("btnTestControl").innerHTML = "Start Test";
        _id("btnTestControl").onclick = function(){testStart();};
        $("#btnGameControl").show();

      }
      Test.prototype.isLeft = function() {
        return this.length() - this.current() - 1;
      }
      Test.prototype.length = function() {
        return this.problems.length;
      }
      Test.prototype.showAProblem = function(problemIndex=gameConfig.currentTest.currentIndex) {
        this.currentProblem = this.problems[problemIndex];
        this.currentIndex = problemIndex;
        let problem = this.currentProblem;
        $("#currentTurn").html(this.current()+1);

        if(this.type === "word") {
          if(problem.key.missed(true)>0)
            $("#testQuestion").html(`<span id="currentTestWord" style="color: #e88282">${problem.key.word}</span>&nbsp;&nbsp; <span style="font-size:15pt;color:lightgray;">[ ${problem.key.pronunciation} ]</span>`);
          else
            $("#testQuestion").html(`<span id="currentTestWord" style="color: #52bb38">${problem.key.word}</span>&nbsp;&nbsp; <span style="font-size:15pt;color:lightgray;">[ ${problem.key.pronunciation} ]</span>`);
        }
        else {
          if(problem.key.missed(true)>0)
            $("#testQuestion").html(`<span id="currentTestWord" style="color: #e88282">${problem.key.memo}</span>`);
          else
            $("#testQuestion").html(`<span id="currentTestWord" style="color: #52bb38">${problem.key.memo}</span>`);
        }

        let dispOrder = randomSequence(problem.words.length);
        removeAllChildNodes($("#testExampleArea")[0]);
        for(let i=0; i<dispOrder.length; i++) {
          if(this.type === "word")
            $(`<div wordindex="${dispOrder[i]}" word="${problem.words[dispOrder[i]].word}" class="testExample nanumMyeongjo">${problem.words[dispOrder[i]].memo}</div>`).appendTo("#testExampleArea");
          else
            $(`<div wordindex="${dispOrder[i]}" word="${problem.words[dispOrder[i]].word}" class="testExample nanumGothic"><span style="font-size:20pt;font-weight:bold;">${problem.words[dispOrder[i]].word}</span></div>`).appendTo("#testExampleArea");
        }
        $("div.testExample").bind("click", function(){checkThisSelection(this);});
        this.currentProblem.timeStarted = new Date();
        $("#keyInput").focus();
      }
      Test.prototype.showNextProblem = function() {
        if(this.isLeft()) {
          this.showAProblem(this.current()+1);
          return true;
        } else {
          this.finishTest();
          return false;
        }
      }
      Test.prototype.startTest = function(type="word") {
        gameConfig.status = "test";
        if(type)
          this.type = type;
        $("#currentTurn").html(1);
        $("#totalProblems").html(this.length());
        this.showNextProblem();
        $("div.testArea").slideDown(1000);
      }
      Test.prototype.suspendTest = function() {
        //문제를 푸는 중에 중단하였으므로 진행 중이던 문제부터 다음에 풀 수 있도록 인덱스 조정
        this.currentProblem = this.problems[--this.currentIndex];
        $("div.testArea").fadeOut(1000);
        $("#keyInput").focus();
        gameConfig.status = "wait";
        _id("btnTestControl").innerHTML = "Start Test";
        _id("btnTestControl").onclick = function(){testStart();};
        _id("btnGameControl").style.visibility = "visible";
        _id("btnViewControl").style.visibility = "visible";
      }
      Test.prototype.typeIs = function(type) {
        this.type = type;
      }
      //===============================================================
      function gameSpeed(value, element) {
        if(value === undefined) {
          return gameConfig.clockSpeed;
        } else if(value === "slower") {
            gameConfig.clockSpeed += 200;
            gameControl("stop&go");
        } else if(value === "faster") {
            gameConfig.clockSpeed -= 200;
            gameConfig.clockSpeed = (gameConfig.clockSpeed < gameConfig.clockSpeedMinimum)? gameConfig.clockSpeedMinimum: gameConfig.clockSpeed;
            gameControl("stop&go");
        } else if(value === "default") {
            gameConfig.clockSpeed = 1000;
            gameControl("stop&go");
        } else {
          if(value >= gameConfig.clockSpeedMinimum)
            gameConfig.clockSpeed = value;
            gameControl("stop&go");
        }
        $("#speedControl").html(gameConfig.clockSpeed);
      }
      function gameControl(mode) {
        if(mode === "go") {
          if(wordSource.handleFetching)
            return;  // game is running now, do nothing.
          wordSource.startFetching();
          wordBase.startMoving();
        } else if(mode === "stop") {
          if(wordSource.handleFetching) {
            wordSource.stopFetching();
            wordBase.stopMoving();
          }
        } else if (mode === "stop&go") {
          if(wordSource.handleFetching) {
            wordSource.stopFetching();
            wordBase.stopMoving();
          }
          wordSource.startFetching();
          wordBase.startMoving();
        } else if(mode === "finished") {
          wordSource.stopFetching();
          wordBase.stopMoving();
          gameConfig.status = "wait";
        }
      }
      function countZoneControl(mode) {
        if(mode === "show") {
          gameConfig.countZoneStaus = "show";
          $("#countZone").fadeIn(700);
          $("#displayMemoControl").fadeIn(700);
          $("#displaySpeedControl").fadeIn(700);
        } else if(mode === "hide") {
          $("#countZone").slideUp(500);
          $("#displayMemoControl").slideUp(500);
          $("#displaySpeedControl").slideUp(500);
          gameConfig.countZoneStaus = "hide";
        } else if(mode === undefined) {
          return gameConfig.countZoneStatus;
        } else if(mode === "hideQuick") {
          $("#countZone").hide();
          $("#displayMemoControl").hide();
          $("#displaySpeedControl").hide();
        }
      }
      function memoControl(mode) {
        if(mode === undefined) {
          return gameConfig.showMemo;
        } else if(mode === true) {
          gameConfig.showMemo = true;
          $("#memoControl").html("ON");
          return true;
        } else if(mode === false) {
          gameConfig.showMemo = false;
          $("#memoControl").html("OFF");
        } else if(mode === "toggle") {
          return memoControl(!gameConfig.showMemo);
        } else {
          return gameConfig.showMemo;
        }
      }
      function spaceControl(mode) {
        if(mode === undefined) {
          return gameConfig.spaceControl;
        } else if(mode === "toggle") {
          gameConfig.spaceControl = (gameConfig.spaceControl)? false : true;
        } else {
          gameConfig.spaceControl = mode;
        }
        $("#spaceControl").html((gameConfig.spaceControl)? "ON" : "OFF");
      }
      //===============================================================
      function checkThisSelection(element) {
        let choice = Number($(element).attr("wordindex"));
        let ct = gameConfig.currentTest;
        let cp = ct.currentProblem;
        $(element).unbind("click");
        if(choice) {  // if selected wroing number
          cp.words[0].missed();
          cp.words[choice].missed();
          cp.words[choice].exposed();
          cp.wrongAnswer = choice;
          $(element).css("backgroundColor", "#fdd");
          if(ct.type === "word") {
            $("#currentTestWord").css("color", "#e41818");
            $(element).prepend(`<span class="nanumGothic" style="font-weight:bold;font-size:20pt;color:red;">${cp.words[choice].word}</span> <span class="pronunciation" style="font-size:15pt;color:#777;">[ ${cp.words[choice].pronunciation} ]</span>: `);
          } else {
            $("#currentTestWord").css("color", "#e41818");
            $(element).html(`<span class="nanumGothic" style="font-weight:bold;font-size:20pt;color:red;" >${cp.words[choice].word}</span> <span class="pronunciation" style="font-size:15pt;color:#777;">[ ${cp.words[choice].pronunciation} ]</span>: ${cp.words[choice].memo}`);
          }
        } else { // selected the correct answer
          $("div.testExample").unbind("click");
          let timeFinished = new Date();
          cp.timeInterval = Math.round((timeFinished.getTime() - cp.timeStarted.getTime())/1000);
          $("#testQuestion").append(`&nbsp;&nbsp;<span style="font-size:12pt;color:#aaa;">${cp.timeInterval} secs.</span>`);
          cp.words[choice].paired();
          cp.words[choice].exposed();
          $(element).css("backgroundColor", "#ddf");
          $("#currentTestWord").css("color", "#3681ff");
          if(ct.type === "word")
            $(element).prepend(`<span class="nanumGothic" style="font-weight:bold;font-size:20pt;color:blue;">${cp.words[choice].word}</span> <span class="pronunciation" style="font-size:15pt;color:#777;">[ ${cp.words[choice].pronunciation} ]</span>: `);
          else {
            $(element).html(`<span class="nanumGothic" style="font-weight:bold;font-size:20pt;color:blue;">${cp.words[choice].word}</span> <span class="pronunciation" style="font-size:15pt;color:#777;">[ ${cp.words[choice].pronunciation} ]</span>: ${cp.words[choice].memo}`);
          }
          if(cp.words[0].missed(true) > 0) {
            if((ct.current()+1) >= ct.length()) //in case of last problem
              setTimeout(function(){gameConfig.currentTest.showNextProblem();}, gameConfig.testInterval);
            else
              $("#testQuestion").append("&nbsp;&nbsp;<button class='btnWP' id='btnNextProblem' onclick='gameConfig.currentTest.showNextProblem();'>Next Problem</button>");
          } else {
            cp.wasHit = true;
            setTimeout(function(){gameConfig.currentTest.showNextProblem();}, gameConfig.testInterval);
          }
        }
        $("#keyInput").focus();
      }
      //===============================================================
      function showListOfWords(collection = gameConfig.currentViewCollection) {
        if(gameConfig.status === "test" || gameConfig.status === "game")
          return;
        if(collection === undefined || collection === null) //지정된 collection이 없으면
          return; // 어떤 처리도 하지 않고 리턴.
        //collection이 결정되어 있거나(gameConfig.currentViewCollection) 매개변수로 전달되었으면(collection)
        //gameConfig.currentViewCollection에 세팅부터 한다.
        gameConfig.currentViewCollection = collection;
        //이후에 필요한 처리를 한다.
        gameConfig.currentViewCollection.showListOfWords(gameConfig.collectionViewStyle);
        gameConfig.status = "view";
        _id("themeTitle").onclick = function(){hideListOfWords();};
        _id("btnViewControl").innerHTML = "Hide Words";
        _id("btnViewControl").onclick = function(){hideListOfWords()};
        _id("btnTestControl").style.visibility = "hidden";
        _id("btnGameControl").style.visibility = "hidden";
        $("#keyInput").focus();
      }
      function hideListOfWords() {
        _id("themeTitle").onclick = function(){showListOfWords();};
        gameConfig.status = "wait";
        $("#collection").fadeOut(200);

        if(gameConfig.currentViewCollection != wordFinished)
          $("#keyInput").val('');

        _id("btnViewControl").innerHTML = "View Words";
        _id("btnViewControl").onclick = function(){showListOfWords()};

        if(gameConfig.currentViewCollection != wordFinished) {
          _id("btnTestControl").style.visibility = "visible";
          _id("btnGameControl").style.visibility = "visible";
        }

        $("#keyInput").focus();
      }
      //===============================================================
      function wordListTipHide(div) {
        $("#wordListTip").hide();
        $("#keyInput").focus();
      }
      function wordListTipShow(div) {
        let word = gameConfig.currentViewCollection.findWord(div.innerHTML.trim());
        if(word) {
          word.exposed();
          $(div).addClass("wordExposed");
          let divp  = $(div).position();
          let tip   = `<span class="nanumGothic" style="font-size:13pt;color:blue;font-weight:bold;">${word.word}</span>`;
          tip      += `&nbsp;<span class="pronunciation">[${word.pronunciation}]</span><hr class="wordListSplit"><span class="nanumMyeongjo">${word.memo}</span>`;
          $("#wordListTip").html(tip);

          let tipWidth = $("#wordListTip").outerWidth(true);
          if((divp.left+tipWidth) > window.innerWidth){
            divp.left = (window.innerWidth-tipWidth-10);
          }

          $("#wordListTip").css({"left": divp.left+"px", "top": (divp.top-$("#wordListTip").outerHeight(true)-4)+"px"});
          $("#wordListTip").show();
        }
        $("#keyInput").focus();
      }
      function wordListTipShowHover(div) {
        let word = gameConfig.currentViewCollection.findWord(div.innerHTML.trim());
        if(word) {
          if(word.exposed(true)) {
            wordListTipShow(div);
          } else {
            return;
          }
        }
      }
      //===============================================================
      function memoHide() {
        $(".memo").fadeOut(200);
        gameConfig.handleMemoShow = null;
        $("#keyInput").focus();
      }
      function memoShow(word) {
        if(gameConfig.showMemo)
          word.exposed();
        let x = $(word.div).css("left");
        let y = $(word.div).css("top");
        $(".memoTitle").html(word.word + `<span class="pronunciation">[${word.pronunciation}]</span>`);
        $(".memoBody").html(word.memo);
        let memoWidth = $(".memo").outerWidth(true);
        if((x.toNumber()+memoWidth) > window.innerWidth)
          x = (window.innerWidth-memoWidth-5)+"px";
        $(".memo").css({"left": x, "top": y}).fadeIn(100);
        $("#keyInput").focus();
      }
      function exposeThisRow(targetTR) {
        let titleWord = $(targetTR).attr("id").substr(3);
        let word      = wordBOOK.findWord(titleWord);
        let memoTD    = targetTR.childNodes[2];
        word.exposed();
        $(memoTD).html(word.memo);
        $(targetTR.childNodes[0]).addClass("wordExposed");
        targetTR.childNodes[3].innerHTML=word.getESMP();
        targetTR.ondblclick = function(){editThisRow(this);};
        $("#keyInput").focus();
      }
      function editFinished() {
        if(gameConfig.currentEditTR) {
          gameConfig.currentEditTR.ondblclick = function(){editThisRow(this);};
          gameConfig.currentEditWord.memo = $("#currentEditWord").val();
          let memoTD = gameConfig.currentEditTR.childNodes[2];
          memoTD.innerHTML = gameConfig.currentEditWord.memo;
          gameConfig.currentEditWord = null;
          //exposeThisRow(gameConfig.currentEditTR);
          gameConfig.currentEditTR = null;
        }
      }
      function editThisRow(targetTR) {
        targetTR.ondblclick = null;
        gameConfig.currentEditTR = targetTR;
        let titleWord = $(targetTR).attr("id").substr(3);
        if(gameConfig.previousViewCollection)
          gameConfig.currentEditWord = wordFinished.findWord(titleWord);
        else
          gameConfig.currentEditWord = wordBOOK.findWord(titleWord);
        let memoTD = targetTR.childNodes[2];
        let memoHTML = `<input onblur="editFinished();" id="currentEditWord" class="nanumMyeongjo" value="${gameConfig.currentEditWord.memo}" />`;
        $(memoTD).html(memoHTML);
        $("#currentEditWord").attr("disabled", false);
        $("#currentEditWord").focus();
      }
      function showTrashCan() {
        if(wordFinished.length() <= 0)
        {
          alert("단어 휴지통이 비어 있습니다.");
          return;
        }
        gameConfig.previousViewCollection = gameConfig.currentViewCollection;
        wordFinished.isCurrentViewCollection();
        showListOfWords();
        $("#trashCanControl").html(`Close Trash Can <span id="trashCount" class="label-mini-value">${wordFinished.length()}</span>`);
        $("#trashCanControl")[0].onclick = function(){hideTrashCan();};

        $("#keyInput").val('Close trash can first~!');

        _id("btnGameControl").style.visibility = "hidden";
        _id("btnTestControl").style.visibility = "hidden";

        $("#keyInput").attr('disabled', true);
      }
      function hideTrashCan() {
        gameConfig.previousViewCollection.isCurrentViewCollection();
        showListOfWords();
        gameConfig.previousViewCollection = null;
        $("#trashCanControl").html(`View Trash Can <span id="trashCount" class="label-mini-value">${wordFinished.length()}</span>`);
        $("#trashCanControl")[0].onclick = function(){showTrashCan();};

        $("#keyInput").val('');

        _id("btnGameControl").style.visibility = "visible";
        _id("btnTestControl").style.visibility = "visible";

        $("#keyInput").attr('disabled', false);
        $("#keyInput").focus();

      }
      //===============================================================
      function pickAllWordsOfWordBOOK() {
        clearGameCollections()
        wordBOOK.searchAndCopyTo("", wordSource);
        let nt = `${wordBOOK.getTitle()} <span class="label-head-orange nanumGothic">전체</span> 단어`;
        wordSource.setTitle(nt);
        themeTitleFrom(wordSource);
        wordSource.copyWordsTo(wordPicked);
        wordPicked.setTitle(nt);
        wordPicked.isCurrentViewCollection();
      }
      function gameStart() {
        if(gameConfig.status === "view")
          hideListOfWords();
        if(gameConfig.currentViewCollection === wordBOOK)
          pickAllWordsOfWordBOOK();
        if(gameConfig.status === "game" || gameConfig.status === "wait") {
          if(gameConfig.status === "wait")
            countZoneControl("show");
          $("#collection").fadeOut(200);
          gameControl("go");
          wordBase.showAll();
          gameConfig.status = "game";
        }
        _id("btnGameControl").innerHTML = "Stop Game";
        _id("btnGameControl").onclick = function(){gameStop()};
        _id("btnTestControl").style.visibility = "hidden";
        _id("btnViewControl").style.visibility = "hidden";
        $("#keyInput").focus();
      }
      function gameStop() {
        if(gameConfig.status === "game") {
          wordBase.markMovingWords("");
          gameControl("stop");
          wordBase.hideAll();
          $("#collection").fadeOut(200);
          gameConfig.status = "wait";
          countZoneControl("hide");
          _id("btnGameControl").innerHTML = "Start Game";
          _id("btnGameControl").onclick = function(){gameStart()};
          _id("btnTestControl").style.visibility = "visible";
          _id("btnViewControl").style.visibility = "visible";
          $("#keyInput").focus();
        }
      }
      function gameReset() {
        wordKilled.searchAndCopyTo("", wordSource);
        wordKilled.clearWords();
        wordMissed.searchAndCopyTo("", wordSource);
        wordMissed.clearWords();
        wordBase.searchAndCopyTo("", wordSource);
        wordBase.clearWords();
        gameControl("finished");
        $("#collection").fadeOut(200);
        countZoneControl("hide");
        _id("btnGameControl").innerHTML = "Start Game";
        _id("btnGameControl").onclick = function(){gameStart()};
        $("#btnTestControl").show();
        $("#keyInput").focus();
        gameConfig.status = "wait";
      }
      function testStart(cmds1) {
        if(gameConfig.status === "game" || gameConfig.status === "test") {
          if(cmds1) {
            gameConfig.currentTest.type = cmds1;
            gameConfig.currentTest.showAProblem();
          }
          return;
        }
        if(gameConfig.status === "view")
          hideListOfWords();
        if(gameConfig.currentTest === null) {
          if(gameConfig.currentViewCollection === wordBOOK)
            pickAllWordsOfWordBOOK();
          if(wordPicked.length() > 0) {
            gameConfig.currentTest = new Test(wordPicked);
            gameConfig.currentTest.startTest(cmds1);
            _id("btnTestControl").innerHTML = "Stop Test";
            _id("btnTestControl").onclick = function(){testStop();};
            _id("btnGameControl").style.visibility = "hidden";
            _id("btnViewControl").style.visibility = "hidden";
            return;
          } else {
            return;
          }
        } else {
          _id("btnTestControl").innerHTML = "Stop Test";
          _id("btnTestControl").onclick = function(){testStop();};
          _id("btnGameControl").style.visibility = "hidden";
          _id("btnViewControl").style.visibility = "hidden";
          gameConfig.currentTest.startTest(cmds1);
        }
      }
      function testStop() {
        if(gameConfig.status === "test") {
          gameConfig.currentTest.suspendTest();
          _id("btnTestControl").innerHTML = "Start Test";
          _id("btnTestControl").onclick = function(){testStart();};
          _id("btnGameControl").style.visibility = "visible";
          _id("btnViewControl").style.visibility = "visible";
        }
      }
      function commandControl(cmd) {
        //빈 칸으로 split 후 빈칸만으로 된 요소는 제거함.
        let cmds = _.map(cmd.split(" "), (x)=>{return x.trim();}).filter((x)=>{return x.length;});
        switch(cmds[0]) {
          case "m": case "memo":
                      memoControl("toggle");
                      break;
          case "slow":
                      gameSpeed("slower");
                      break;
          case "fast":
                      gameSpeed("faster");
                      break;
          case "space":
                      spaceControl("toggle");
                      break;
          case "q": case "ㅂ": case "quit":
                      if(gameConfig.status === "test") {
                        testStop(cmds[1]);
                      } else if(gameConfig.status === "game") {
                        gameStop();
                      }
                      countZoneControl("hide");
                      break;
          case "d": case "ㅇ": case "drop":
                      hideListOfWords();
                      clearGameCollections();
                      wordBOOK.isCurrentViewCollection();
                      gameConfig.status = "wait";
                      countZoneControl("hide");
                      break;
          case "h": case "ㅗ": case "hide":
                      hideListOfWords();
                      break;
          case "v": case "ㅍ": case "view":
                      if(gameConfig.status === "wait") {
                        showListOfWords();
                      } else if(gameConfig.status === "view") {
                        hideListOfWords();
                      }
                      $("#keyInput").focus();
                      break;
          case "t": case "ㅅ": case "test":
                      testStart(cmds[1]);
                      break;
          case "s": case "ㄴ": case "stop":
                      // if(gameConfig.status === "game") {
                        gameControl("stop");
                      // }
                      break;
          case "j":
                      wordBOOK.toNewWindowInJSON();
                      break;
          case "g": case "ㅎ": case "go":
                      gameStart();
                      break;
          case "play again": case "pa":
                      if(gameConfig.status === "game" || gameConfig.status === "wait") {
                        gameReset();
                      }
                      break;
          case "p": case "ㅔ": case "pick":
                      if(gameConfig.status === "view")
                        hideListOfWords();
                      if(gameConfig.status === "wait") {
                        let sel = '';
                        if(cmds.length < 2) {
                          sel = prompt("검색할 단어의 시작 문자열을 입력해 주세요. (빈 칸은 모두 선택입니다.)");
                        } else {
                          sel = cmds[1];
                        }
                        if(sel.startsWith('~')) {
                          let count = 20;
                          if(cmds.length > 2)
                            count = cmds[2].toNumber();
                          clearGameCollections()
                          wordBOOK.randomSelectAndCopyTo(count, wordSource);
                          let nt = `${wordBOOK.getTitle()} 중에서 <span class="label-head-orange nanumGothic">임의로 뽑은 <span class="label-value-skey">${count}</span>개</span> 단어`;
                          wordSource.setTitle(nt);
                          themeTitleFrom(wordSource);
                          wordSource.copyWordsTo(wordPicked);
                          wordPicked.setTitle(nt);
                          wordPicked.isCurrentViewCollection();
                        } else {
                          let numberOfSelected = wordBOOK.selectedLength(sel);
                          if(numberOfSelected) {
                            if(confirm(`[${numberOfSelected}]개의 단어가 검색되었습니다. 검색 결과로 시작할까요?`)) {
                              clearGameCollections()
                              wordBOOK.searchAndCopyTo(sel, wordSource);
                              let nt = "";
                              if(sel === "")
                                nt = `${wordBOOK.getTitle()} <span class="label-head-orange nanumGothic">전체</span> 단어`;
                              else
                                nt = `${wordBOOK.getTitle()} 중에서 <span class="label-head-orange nanumGothic"><span class="label-value-skey">${sel}</span>로 시작하는 </span> 단어`;
                              wordSource.setTitle(nt);
                              themeTitleFrom(wordSource);
                              wordSource.copyWordsTo(wordPicked);
                              wordPicked.setTitle(nt);
                              wordPicked.isCurrentViewCollection();
                            }
                          } else {
                            alert(`[${sel}]로 검색된 단어가 없습니다.`);
                            return;
                          }
                        }
                      }
                      break;
          case "save":
                      saveWordBOOKToLocalStorage();
                      break;
          case "r": case "reserved":
                      if(gameConfig.status === "view")
                        $(".tableReserved").toggle();
                      break;
        }
      }
      function saveWordBOOKToLocalStorage() {
        let saveStr = wordBOOK.toString();
        localStorage.setItem("wordBOOK", saveStr);
        saveStr = wordFinished.toString();
        localStorage.setItem("wordFinished", saveStr);
        alert("wordBOOK, wordFinished saved.")
      }
      function getWordBOOKFromLocalStorage() {
        let saveStr = localStorage.getItem("wordBOOK");
        let savedWordBOOK = JSON.parse(saveStr);
        if(saveStr) {
          let msg = `현재 사용 중인 컴퓨터에 저장되어 있는 단어장 [${savedWordBOOK.title}]이 있습니다. 저장된 단어장을 사용하시겠습니까?`;
          let result = confirm(msg);
          if(result == false)
            return false;
          else {
            wordBOOK.setTitle(savedWordBOOK.title);
            for(let aSavedWord of savedWordBOOK.words) {
              let aNewWord = new Word(aSavedWord.word, aSavedWord.memo, aSavedWord.pronunciation);
              aNewWord.getPropertyFromSavedWord(aSavedWord);
              wordBOOK.push(aNewWord);
            }// end of for loop
            let finishedStr = localStorage.getItem("wordFinished");
            if(finishedStr) {
              let savedFinishedBook = JSON.parse(finishedStr);
              for(let aWord of savedFinishedBook.words) {
                let aFinishedWord = new Word(aWord.word, aWord.memo, aWord.pronunciation);
                aFinishedWord.getPropertyFromSavedWord(aWord);
                wordFinished.push(aFinishedWord);
              }
            }
            return true;
          }  // end of else of if(result == false)
        } // end of if(saveStr)
      }
      function showHelpInfo() {
        if(gameConfig.status === "game")
          gameControl("stop");
        if(gameConfig.helpInfoStatus)
          return hideHelpInfo();
        _id("helpInfo").style.display = "block";
        _id("helpInfo").onclick = function(){$("#keyInput").focus();};
        gameConfig.helpInfoStatus = true;
        _id("keyInput").focus();
        return true;
      }
      function hideHelpInfo() {
        _id("helpInfo").style.display = "none";
        $("#keyInput").val("");
        $("#keyInput").focus();
        gameConfig.helpInfoStatus = false;
        if(gameConfig.status === "game")
          gameControl("go");
        _id("keyInput").focus();
        return false;
      }
      function inputControl() {
        if(event.keyCode == 27) {
          showHelpInfo();
          return;
        }
        let input = _id('keyInput');
        let value = input.value.trim();
        if(value[0] == '/') {
          $("#keyInput").css("backgroundColor", "#fec3c3");
        } else {
          $("#keyInput").css("backgroundColor", "#c5f0db");
        }
        if(event.keyCode == 32) {
          if(value[0] == '/')
            return;
        }
        if(event.keyCode == 13 || event.keyCode == 32) {
          if(event.keyCode == 32 && gameConfig.spaceControl == false)
            return;
          input.value = "";
          $("#keyInput").css("backgroundColor", "#c5f0db");

          if(value.length > 0) {
            if(value.charAt(0) == '/')
              commandControl(value.substr(1).toLowerCase());
            else {
              wordBase.findAndFetchToDefault(value);
              wordBase.markMovingWords("");
            }
          }
        } else {
          if(gameConfig.status === "game")
            wordBase.markMovingWords(value);
          else if(gameConfig.status === "view") {
            if(value.charAt(0) == '/')
              return;
            let prefix = (gameConfig.collectionViewStyle === "WordList")? "WL_" : "WT_";
            if(prefix === "WT_"){
              $(".tableWordRow").hide();
              $(`[id^='WT_${value}']`).show();
            } else {
              $(".wordList").hide();
              $(`[id^='WL_${value}']`).show();
            }
          }
        }
      }
      //===============================================================
      //length개(0~length-1) 중 임의로 count개만큼 선택하여 배열로 리턴.
      function randomSequence(length, count=length, except=-1) {
        let sourceIndexArray = [];
        let randomIndexArray = [];
        count = (count > length)? length : count;
        for(let i=0; i<length; i++)
          sourceIndexArray.push(i);
        if(except < 0) {
          for(let i=0; i<count; i++)
            randomIndexArray.push(sourceIndexArray.splice(Math.floor(Math.random()*sourceIndexArray.length),1)[0]);
        } else {
          sourceIndexArray.splice(except, 1);  // remove item[except]
          count = (count >= length)? length-1 : count;
          for(let i=0; i<count; i++)
            randomIndexArray.push(sourceIndexArray.splice(Math.floor(Math.random()*sourceIndexArray.length),1)[0]);
        }
        return randomIndexArray;
      }
      function _id(id) {
        return document.getElementById(id);
      }
      function removeAllChildNodes(node) {
        while(node.hasChildNodes()) {
          node.removeChild(node.firstChild);
        }
      }
      function btnTimer() {
        // $("#btnNextProblem").html(30);
        function countDown() {
          let c = $("#btnNextProblem").text();
          $("#btnNextProblem").text(c-1);
        }
        let handle = setInterval(countDown, 1000);
        setTimeout(function(){clearInterval(handle);}, gameConfig.testInterval);
      }
      //===============================================================
      function dragStart(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
        gameConfig.draggedElement = ev.target;
        if(gameConfig.previousViewCollection)
          gameConfig.draggedWord = wordFinished.findWord(ev.target.id.substr(3));
        else
          gameConfig.draggedWord = wordBOOK.findWord(ev.target.id.substr(3));

        wordListTipHide(ev.target);
        if(gameConfig.previousViewCollection)
          $("#wordNote").show(300);
        else
          $("#trashCan").show(300);
      }
      function dragAllowDrop(ev) {
        ev.preventDefault();
      }
      function dragEnd(ev) {
        $("#wordNote").hide(500);
        $("#trashCan").hide(500);
        $("#wordNote").attr("src", "./image/greenBookNormal.png");
        $("#trashCan").attr("src", "./image/trash_can_close.png");
        gameConfig.draggedElement = null;
        gameConfig.draggedWord = null
      }
      function dragEnter(ev) {
        if(gameConfig.previousViewCollection) {
          $("#wordNote").attr("src", "./image/greenBookDrop.png");
        } else {
          if(gameConfig.draggedWord.exposed(true) <= 0 || gameConfig.draggedWord.score()<0)
            $("#trashCan").attr("src", "./image/trash_can_close_tightly.png");
          else
            $("#trashCan").attr("src", "./image/trash_can_open.png");
        }
      }
      function dragLeave(ev) {
        if(gameConfig.previousViewCollection)
          $("#wordNote").attr("src", "./image/greenBookNormal.png");
        else
          $("#trashCan").attr("src", "./image/trash_can_close.png");
      }
      function dragDrop(ev) {
        ev.preventDefault();
        let wordStr = ev.dataTransfer.getData("text").substr(3);
        let dispType = ev.dataTransfer.getData("texxt").substr(0,2);
        if(gameConfig.previousViewCollection){
          if(gameConfig.draggedWord === null) {
            $("#wordNote").attr("src", "./image/greenBookNormal.png");
            gameConfig.draggedElement = null;
            gameConfig.draggedWord = null
            return;
          }
          $("#wordNote").attr("src", "./image/greenBookNormal.png");
          let tWord = wordFinished.findAndPick(wordStr);
          wordBOOK.push(tWord);
          if(gameConfig.previousViewCollection !== gameConfig.masterCollection)
            gameConfig.previousViewCollection.push(tWord);
          gameConfig.draggedElement.parentNode.removeChild(gameConfig.draggedElement);
          gameConfig.draggedElement = null;
          if(gameConfig.currentViewCollection.length() <= 0) {
            hideListOfWords();
            gameConfig.previousViewCollection.isCurrentViewCollection();
            gameConfig.status = "wait";
            countZoneControl("hide");

            gameConfig.previousViewCollection = null;
            $("#trashCanControl").html(`View Trash Can <span id="trashCount" class="label-mini-value">${wordFinished.length()}</span>`);
            $("#trashCanControl")[0].onclick = function(){showTrashCan();};

            $("#keyInput").val('');
            $("#keyInput").attr('disabled', false);
            $("#keyInput").focus();

          }
        } else {
          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
          if((gameConfig.draggedWord === null) || (gameConfig.draggedWord.score() < 0) || (gameConfig.draggedWord.exposed(true) <= 0) ) {
            $("#trashCan").attr("src", "./image/trash_can_close_tightly.png");
            gameConfig.draggedElement = null;
            gameConfig.draggedWord = null
            return;
          }
          $("#trashCan").attr("src", "./image/trash_can_close.png");
          wordFinished.push(wordBOOK.findAndPick(wordStr));
          $("#trashCanControl").show();
          if(gameConfig.currentViewCollection !== gameConfig.masterCollection)
            gameConfig.currentViewCollection.findAndPick(wordStr);
          gameConfig.draggedElement.parentNode.removeChild(gameConfig.draggedElement);
          gameConfig.draggedElement = null;
          // if(dispType == "WT") {
            $("tr.tableWordRow:odd").css("backgroundColor", "#c4fccd");
            $("tr.tableWordRow:even").css("backgroundColor", "#dfffdf");
          // }
          if(gameConfig.currentViewCollection.length() <= 0) {
            hideListOfWords();
            clearGameCollections();
            wordBOOK.isCurrentViewCollection();
            gameConfig.status = "wait";
            countZoneControl("hide");

          }
          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        }
      }
      //===============================================================
      function collectionViewStyleIs(style = "WordList") {
        gameConfig.collectionViewStyle = style;
        showListOfWords();
      }
      function clearGameCollections() {
        wordSource.clearWords();
        wordBase.clearWords();
        wordKilled.clearWords();
        wordMissed.clearWords();
        wordPicked.clearWords();
        if(gameConfig.currentTest)
          gameConfig.currentTest.finishTest();
      }
      function setShowCollection(body, title, list) {
        gameConfig.showCollectionBody = body;
        gameConfig.showCollectionTitle = title;
        gameConfig.showCollectionList = list;
      }
      function setHeightOfCollection() {
        let winHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        let collectionHeight = winHeight - gameConfig.heightOfInfoDiv - gameConfig.heightOfDefenceBase - 50;
        $("#collection").css("maxHeight", collectionHeight/2+"px");
      }
      function themeTitleFrom(collection) {
        _id("themeTitle").innerHTML = collection.title;
      }
      function resizeLogo() {
        let windowWidth = window.innerWidth;
        let titleFontSize = gameConfig.referencePoint*window.innerWidth/gameConfig.referenceWidth;
        let signFontSize = gameConfig.referenceTextPoint*window.innerWidth/gameConfig.referenceWidth;
        let signMarginTop = 50*window.innerWidth/gameConfig.referenceWidth;
        _id("logoTitle").style.fontSize = titleFontSize+"pt";
        _id("developerSign").style.fontSize = signFontSize+"pt";
        _id("developerSign").style.marginTop = signMarginTop+"px";
      }
      function starting() {
        $("#startingPanel").fadeOut(500);

        setTimeout(function(){
          if(!getWordBOOKFromLocalStorage()) {
            let wordBook = wordBook_2017_004; // <== from included js word book file.
            wordBOOK.makeWordsFromWordBook(wordBook);
          } else {
            wordBook_2017_004 = null;
            setTimeout(function(){$("#labelLocal").fadeIn(1000);}, 1500);
          }
          gameConfig.masterCollection = wordBOOK;
          wordBOOK.isCurrentViewCollection();
          gameConfig.lengthOfMaster = wordBOOK.length();
          // themeTitleFrom(wordBOOK);
          //----------------------------------------------------------------
          wordBase.targetToFetchOutIs(wordKilled);
          wordBase.targetForMissedIs(wordMissed);
          //----------------------------------------------------------------
          wordSource.targetToFetchOutIs(wordBase);
          wordSource.showLength(_id('wordsWaiting'));
          wordKilled.showLength(_id('wordsCatched'));
          wordMissed.showLength(_id('wordsMissed'));
          wordBOOK.showLength(_id('wordsTotal'));

          $("#infoDiv").fadeIn(500);
          $("#commandDiv").fadeIn(500);
          $("#keyInput").focus();
        }, 300); // end of setTimeout;
        setTimeout(function() {
          gameConfig.heightOfInfoDiv = $("#infoDiv").outerHeight(true);
          gameConfig.heightOfDefenceBase = $(".defenceBase").outerHeight(true);
          setHeightOfCollection();
          gameConfig.startTop = $("#infoDiv").outerHeight(true)+15;
          gameConfig.defenceBaseTop = $(".defenceBase").css("top").toNumber();
        }, 450);
      }
      function openInfoTab(evt, tabId="wpInfoIntro") {
        var i, x, tablinks;
        x = document.getElementsByClassName("wpGuide");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < x.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" w3-indigo", "");
        }
        document.getElementById(tabId).style.display = "block";
        evt.currentTarget.className += " w3-indigo";
      }
      //#######################################################################
      $(document).ready(function(){
        $(window).resize(resizeLogo);
        $("#startingPanel").click(starting);
        setShowCollection(_id("collection"), _id("collectionTitle"), _id("collectionWords"));
        $(".memo").hide();
        $("#keyInput").keyup(inputControl);
        $("#wordListTip").hide();

        resizeLogo();
        $("#startingPanel").fadeIn(1000);
        //#######################################################################
      });
    </script>
  </head>
  <body onunload="saveWordBOOKToLocalStorage();">
    <!-- ============================================================== -->
    <div style="display:none;" class="psho-container psho-shadow-default" id="infoDiv">
      <table width=100%>
        <tr>
          <td style="width: 200px;">
            <div class="psho-label-title frederikaTheGreat" id="appTitle" onclick="showHelpInfo()">Word Practice</div>
            <div class="nanumGothicCoding miniLabel" id="labelLocal">local</div>
          </td>
          <td style="text-align:left;">
                <span class="bander-navy label-head nanumGothic" id="themeTitle" onclick="showListOfWords();">Theme Title</span>&nbsp;&nbsp;&nbsp;
                <span class="label-head">Total:<span class="label-value" id="wordsTotal">0</span> words</span>
          </td>
          <td style="text-align:left;">
            <button class='btnWP' id="btnViewControl" onclick="showListOfWords();" class="nanumgothic">View Words</button>
            <button class='btnWP' id="btnGameControl" onclick="gameStart();" class="nanumgothic">Start Game</button>
            <button class='btnWP' id="btnTestControl" onclick="testStart();" class="nanumgothic">Start Test</button>
          </td>
          <td style="text-align: right; width: 350px;">
            <div id="countZone" style="display:none;">
              <span class="bander-default nanumGothic" >
                <span class="label-head ">Standby:</span>
                <span class="label-value " id="wordsWaiting">-</span>
              </span>
              <span class="bander-default nanumGothic" >
                <span class="label-head ">Hit:</span>
                <span class="label-value" id="wordsCatched">-</span>
              </span>
              <span class="bander-default nanumGothic" >
                <span class="label-head ">Miss:</span>
                <span class="label-value " id="wordsMissed">-</span>
              </span>
            </div>
          </td>
        </tr>
      </table>
    </div>
    <!-- ======================vvv Test Area Design vvvv======================= -->
    <div class="testArea nanumGothic">
      <div class="testHead nanumGothic">
        <table width="100%">
          <tr>
            <td>Problem: <span class="label-value" id="currentTurn"></span> of <span class="label-value-off" id="totalProblems"></span> </td>
            <td width="50%" id="testTitle"></td>
            <!-- <td><button class='btnWP' style="float: right;" id='btnQuitTest' onclick='gameConfig.currentTest.suspendTest();'>Stop Test</button></td> -->
          </tr>
        </table>
      </div>
      <div class="testBody nanumGothic">
        <div id="testQuestion"></div>
        <div id="testExampleArea"> </div>
      </div>
    </div>
    <!-- =======================^^^ Test Area Design ^^^======================= -->
    <div id="helpInfo" class="w3-modal ">
      <div class="w3-modal-content ">
        <header class="frederikaTheGreat w3-container w3-teal ">
          <span onclick="hideHelpInfo();"
          class="w3-button w3-xlarge w3-display-topright w3-round">&times;</span>
          <h2 class="nanumGothic">How to use <span class="frederikaTheGreat">Word Practice</span></h2>
        </header>
        <div class="w3-container nanumGothic" style="padding:0px; max-height: 450px; overflow: scroll;">
        <!-- ################# TAB Help Information #############################  -->
          <div class="w3-bar w3-cyan" style="width:100%; position:sticky; top: 0;">
            <button class="w3-bar-item nanumGothic w3-button tablink w3-indigo" onclick="openInfoTab(event,'wpInfoIntro')">Intro</button>
            <button class="w3-bar-item nanumGothic w3-button tablink" onclick="openInfoTab(event,'wpInfoCommand')">Command</button>
            <button class="w3-bar-item nanumGothic w3-button tablink" onclick="openInfoTab(event,'wpInfoPickDrop')">Pick &amp; Drop</button>
            <button class="w3-bar-item nanumGothic w3-button tablink" onclick="openInfoTab(event,'wpInfoView')">View</button>
            <button class="w3-bar-item nanumGothic w3-button tablink" onclick="openInfoTab(event,'wpInfoGame')">Game</button>
            <button class="w3-bar-item nanumGothic w3-button tablink" onclick="openInfoTab(event,'wpInfoTest')">Test</button>
          </div>
          <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~ TAB Contents Start VV ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
          <div id="wpInfoIntro" class="w3-container w3-border wpGuide">
            <h2>Intro.</h2>
            <p class="nanumGothic"><img src="./image/wpoverview.png" style="float:right;" width=400px/>
              <span class="frederikaTheGreat">Word Practice</span>는 영어 단어 학습을 돕기 위해 개발되었습니다. <br>
              프로그램의 기능은 다음 세 개로 구성됩니다.<br />
              <ul class="nanumGothic">
                <li><span class="litem scpro"><b>V</b>iew</span>: 단어장 단어 목록 보기 (기본 단어장 또는 선택 단어장) </li>
                <li><span class="litem scpro"><b>G</b>ame</span>: 기본 또는 선택 단어장으로 게임하기 </li>
                <li><span class="litem scpro"><b>T</b>est</span>: 기본 또는 선택 단어장으로 단어 테스트 하기 </li>
              </ul>
              기본 단어장에서 일부 단어를 선택하여 생성한 선택 단어장으로도 View, Game, Test를 진행할 수 있습니다.<br />
              선택 단어장은 언제든지 취소하고 기본 단어장으로 돌아갈 수 있습니다.
              <ul class="nanumGothic">
                <li><span style="background-color: #ffe599;" class="litem scpro"><b>P</b>ick</span>: 기본 단어장에서 단어 선택하기 </li>
                <li><span style="background-color: #ffe599;" class="litem scpro"><b>D</b>rop</span>: 선택 단어장 취소하고 기본 단어장으로 돌아가기</li>
              </ul>
            </p>

          </div>
          <!-- Word and Command -->
          <div id="wpInfoCommand" class="w3-container w3-border wpGuide" style="display:none">
            <h2>Command</h2>
            <div class="w3-border-bottom" ><span class="w3-tag w3-large frederikaTheGreat w3-white">Word Practice</span>에서 단어와 <span class="w3-tag w3-blue">명령</span>은 화면 하단의 Input에 입력합니다.<img src="./image/wpInput.png" style="display:inline-block;width: 250px;" /> </div>
            <ul class="nanumGothic">
              <li><b>단어 입력</b></li>: 게임에서는 내려오는 단어를, 단어장 보기에서 검색어를 입력합니다.<img src="./image/wpInputWord.png" style="display:inline-block; width: 250px;" /><br />
                        : 단어 입력은 <span class="codeKey">ENTER</span> 또는 <span class="codeKey">SPACE</span>로 확인합니다.<br /><br />
              <li><b>명령 입력</b></li>: 모든 <span class="w3-tag w3-blue">명령</span>은 <span class="codeKey">/</span>로 시작합니다.<img src="./image/wpInputCommand.png" style="display:inline-block;width: 250px;" /><br />
                        : 명령을 입력할 때는 입력란이 분홍색으로 바뀝니다.
            </ul>
          </div>
          <!-- Pick & Drop -->
          <div id="wpInfoPickDrop" class="w3-container w3-border wpGuide" style="display:none">
            <h2>Pick &amp; Drop</h2>
            <p ><span class="w3-large frederikaTheGreat w3-white">Word Practice</span>는 미리 설정된 단어장 또는 브라우저에 저장된 단어장(<img src="./image/local.png" height=20px /> 표시됨)을 선택하여 기본 단어장으로 사용합니다.</p>
            <p>기본 단어장에서 <span class="codeKey">/p</span> 명령으로 일부 단어들을 뽑아 생성한 선택 단어장으로 단어 연습(View, Game, Test)을 진행할 수 있습니다.</p>
            <p>선택 단어장은 <span class="codeKey">/d</span> 명령으로 해제하고 기본 단어장으로 돌아갈 수 있습니다.</p><hr />

            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">P</span>ick</b></span>:<span class="codeKey"><b>/p</b></span> 검색할 단어를 입력하는 창으로 연결됩니다. (빈 칸을 입력하면 전체 단어가 선택됩니다.)</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">P</span>ick</b></span>:<span class="codeKey"><b>/p ~ 20</b></span> 기본 단어장에서 임의로 <span class="w3-tag w3-yellow"> 20 </span>개를 추출하여 선택 단어장으로 설정합니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">P</span>ick</b></span>:<span class="codeKey"><b>/p ab</b></span> 기본 단어장에서 <span class="w3-tag w3-yellow"> ab </span>로 시작하는 단어들을 모두 선택 단어장으로 설정합니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">D</span>rop</b></span>:<span class="codeKey"><b>/d</b></span> 선택 단어장을 해제합니다. 해제 후에는 기본 단어장으로 돌아갑니다.</p>
          </div>
          <!-- View -->
          <div id="wpInfoView" class="w3-container w3-border wpGuide" style="display:none">
            <h2>View</h2>
            <p class="nanumGothic">현재 단어장(기본 단어장 또는 선택 단어장)의 단어들을 두 가지 방식(<img src="./image/btnWordOnly.png" height=25px />, <img src="./image/btnWordBook.png" height=25px />)로 보여줍니다.</p><hr />
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">V</span>iew</b></span>:<span class="codeKey"><b>/v</b></span> 현재 단어장의 단어 목록을 보여줍니다. 화면 상단의 버튼 <img src="./image/btnViewWords.png" height=25px />으로도 볼 수 있습니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">H</span>ide</b></span>:<span class="codeKey"><b>/h</b></span> 단어장 보기를 중단합니다. 화면 상단의 버튼 <img src="./image/btnHideWords.png" height=25px />으로도 보기 화면이 종료됩니다.</p>
            <p onclick="$('#imgViewWordOnly').slideToggle(600);"><span class="codeKey" style="background-color:#DDFFDD;">⇣</span> <span class="w3-tag scpro w3-gray"><b>View</b></span> <img src="./image/btnWordOnly.png" height=25px />: 현재 단어장의 단어만 목록으로 보여줍니다. (단어를 클릭하면 발음기호, 의미가 표시됩니다.)</p>
            <img onclick="$(this).slideToggle(600);" id="imgViewWordOnly" src="./image/wordList.png" width=800px style="float: center; display:none;"/>
            <p onclick="$('#imgViewWordBook').slideToggle(600);"><span class="codeKey" style="background-color:#DDFFDD;">⇣</span> <span class="w3-tag scpro w3-gray"><b>View</b></span> <img src="./image/btnWordBook.png" height=25px />: 단어, 발음기호, 의미를 보여줍니다. (의미가 ?로 된 단어는 한 번 클릭하면 계속 보이게 됩니다.)</p>
            <img onclick="$(this).slideToggle(600);" id="imgViewWordBook" src="./image/wordBook.png" width=800px style="float: center; display:none;"/>
            <p onclick="$('#imgViewWordBookEdit').slideToggle(600);"><span class="codeKey" style="background-color:#DDFFDD;">⇣</span> <span class="w3-tag scpro w3-gray"><b>View Edit</b></span>  <img src="./image/btnWordBook.png" height=25px />: 보기에서 단어를 포함하는 행을 <span class="codeKey"><b>Double Click</b></span>하면 의미를 수정, 편집 가능합니다.</p>
            <img onclick="$(this).slideToggle(600);" id="imgViewWordBookEdit" src="./image/wordBookEdit.png" width=800px style="float: center; display:none;"/>
          </div>

          <!-- Game -->
          <div id="wpInfoGame" class="w3-container w3-border wpGuide" style="display:none">
            <h2>Game</h2>
            <p>현재 단어장의 단어들이 임의의 순서로 화면 상단에서 차례로 내려오면 단어를 입력하여 제거하는 일명 산성비 게임입니다.</p><hr />
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">G</span>ame</b></span>:<span class="codeKey"><b>/g</b></span> 게임을 시작합니다. 화면 상단의 버튼 <img src="./image/btnStartGame.png" height=25px />으로도 시작할 수 있습니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">Q</span>uit</b></span>:<span class="codeKey"><b>/q</b></span> 게임을 중단합니다. 화면 상단의 버튼 <img src="./image/btnStopGame.png" height=25px />으로도 중단할 수 있습니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">S</span>top</b></span>:<span class="codeKey"><b>/s</b></span> 단어들의 이동을 중단합니다. 이 상태에서도 단어를 입력하여 제거할 수 있습니다. <span class="codeKey"><b>/g</b></span>로 다시 이동하게 합니다. </p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">M</span>emo</b></span>:<span class="codeKey"><b>/m</b></span> 단어가 제거될 때, 발음기호와 의미를 표시하는 기능을 켭니다. 이 기능 해제할 때도 <span class="codeKey"><b>/m</b></span> 명령을 사용합니다. </p>
            <p><span class="w3-tag scpro w3-gray"><b>speed</b></span>: 단어의 하강 속도를 조절할 수 있습니다. <span class="codeKey"><b>/fast</b></span>: 0.2초 빨라집니다. <span class="codeKey"><b>/slow</b></span>: 0.2초 느려집니다. </p>
            <p><span class="w3-tag scpro w3-gray"><b>SPACE</b></span>: <span class="codeKey"><b>/space</b></span> SPACE 키 입력을 ENTER 입력과 같은 의미로 처리하는 기능을 설정하거나 해제합니다.</p>

          </div>

          <!-- Test -->
          <div id="wpInfoTest" class="w3-container w3-border wpGuide" style="display:none">
            <h2>Test</h2>
            <p>현재 단어장의 단어 테스트를 다음 두 가지 방식으로 진행할 수 있습니다.</p>
            <p><span class="w3-tag w3-yellow">단어 모드</span>: 제시된 단어에 알맞은 뜻을 보기에서 고르는 형식   <span class="w3-tag w3-yellow">의미모드</span>: 제시된 의미에 맞는 단어를 보기에서 고르는 형식</p>
            <p><span class="w3-tag w3-blue">문제 풀기</span>: 제시된 보기에서 하나를 선택합니다. 결과는 바로 표시됩니다. 정답이 선택될 때까지 계속 선택해야 합니다. </p>
            <p><span class="w3-tag w3-blue">문제 진행</span>: 한 번에 맞추면 다음 문제로 자동 진행됩니다. 오답을 한 번 이상 고른 경우에는 <img src="./image/btnNextProblem.png" height=25px />을 클릭해야만 합니다. </p>
            <hr />
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">T</span>est</b></span>:<span class="codeKey"><b>/t</b></span> 단어 테스트를 시작합니다. 화면 상단의 버튼 <img src="./image/btnStartTest.png" height=25px />으로도 시작할 수 있습니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b><span style="color:white;">Q</span>uit</b></span>:<span class="codeKey"><b>/q</b></span> 단어 테스트를 중단합니다. 화면 상단의 버튼 <img src="./image/btnStopTest.png" height=25px />으로도 중단할 수 있습니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b>단어 모드 설정</b></span>: <span class="codeKey"><b>/t word</b></span>: 단어 모드로 설정합니다.</p>
            <p><span class="w3-tag scpro w3-gray"><b>의미 모드 설정</b></span>: <span class="codeKey"><b>/t memo</b></span>: 의미 모드로 설정합니다.</p>

          </div>
          <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~ TAB Contents End ^^ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <!-- ################# TAB Help Information #############################  -->
        </div>
        <footer class="w3-container w3-teal ">
          <p>Designed by Pongsik, Ho. / pshonature@gmail.com /  Dept. of Computer Information, DIT</p>
        </footer>
      </div>
    </div>
    <!-- ============================================================== -->
    <div id="collection">
      <div id="collectionTitleArea" >
        <table>
          <tr>
            <td style="vertical-align: middle;"  >
              <button class="nanumGothic btnWP" id="btnHideThisCollection" title="Close word list view." onclick="hideListOfWords();"> X </button>
              <button class="nanumGothic btnWP" id="btnWordList" onclick="collectionViewStyleIs();">Word Only</button>
              <button class="nanumGothic btnWP" id="btnWordBook" onclick="collectionViewStyleIs('WordBook');">Word Book</button>
            </td>
            <td style="vertical-align: middle;">
              <button class="nanumGothic btnWP" id="trashCanControl" onclick="showTrashCan();">View Trash Can <span id="trashCount" class="label-mini-value"></span></button>
            </td>
            <td style="vertical-align: middle;">
              <div id="collectionTitle">
              </div>
            </td>
          </tr>
        </table>
      </div>
      <div id="collectionWords"></div>
    </div>
    <!-- ============================================================== -->
    <div class="logoContainer" id="startingPanel" style="display:none;">
      <div class="logoText">
        <div class="frederikaTheGreat" style="font-size:10%;" id="logoTitle">Word Practice</div>
        <hr width=70% style="margin-left:auto; margin-right: auto;" />
        <div id="developerSign" class="nanmumGothic" style="margin-top: 50px; font-size: 15pt; text-align: center; bottom: 0;">
          Developed by Pongsik, Ho<br />
          Dept. of Computer Information, DIT<br />
          Copyright(c) 2017-2018. All rights reserved.
        </div>
      </div>
    </div>
    <!-- ============================================================== -->
    <div class='memo'> <div class='memoTitle'></div> <div class='memoBody nanumMyeongjo'></div></div>
    <div id="wordListTip" class="bubbleTip" style="display: none;"> </div>
    <!-- <p id="demo"></p> -->
    <div style="display:none;" class="defenceBase" id="commandDiv">
      <table style="font-size: 12pt; width:100%;">
        <tr>
          <td style="font-size: 14pt; padding:5px; width: 300px;">
            <span class="label-head">Input:</span> <input autocomplete="off" class="label-head" id="keyInput" size="20" />
          </td>
          <td style="text-align: left;">
            <span class="bander-default nanumGothic" id="displaySpaceControl" >
              <span class="label-head "> Space ENTER:</span>
              <span class="label-value " id="spaceControl">ON</span>
            </span>
            <span style="display:none;" class="bander-default nanumGothic" id="displayMemoControl" >
              <span class="label-head "> Word Memo:</span>
              <span class="label-value " id="memoControl">OFF</span>
            </span>
            <span style="display:none;" class="bander-default nanumGothic" id="displaySpeedControl" >
              <span class="label-head "> Speed:</span>
              <span class="label-value " id="speedControl">1000</span>
            </span>
          </td>
          <td class="nanumGothic" style="font-size: 7pt; text-align:right;">
            Designed by Pongsik, Ho. Dept. of Computer Information, DIT.<br />Copyright(c) 2017-2018 All rights reserved.<br />
            Version:[180101.1]
          </td>
        </tr>
      </table>
    </div>
    <img style="display:none;" id="trashCan" src="./image/trash_can_close.PNG" ondragenter="dragEnter(event);" ondragleave="dragLeave(event);" ondrop="dragDrop(event);" ondragover="dragAllowDrop(event);"/>
    <img style="display:none;" id="wordNote" src="./image/greenBookNormal.PNG" ondragenter="dragEnter(event);" ondragleave="dragLeave(event);" ondrop="dragDrop(event);" ondragover="dragAllowDrop(event);"/>
  </body>
</html>
